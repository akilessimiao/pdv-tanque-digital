create table if not exists activation_keys (
  id uuid primary key default gen_random_uuid (),
  serial_key text unique not null,
  is_used boolean default false,
  client_id uuid,
  created_at timestamp default now()
);

create table if not exists companies (
  id uuid primary key default gen_random_uuid (),
  company_name text not null,
  cnpj text,
  phone text,
  address text,
  logo_url text,
  created_at timestamp default now()
);

create table if not exists users (
  id uuid primary key default gen_random_uuid (),
  company_id uuid references companies (id) on delete cascade,
  username text not null unique,
  password_hash text not null,
  role text check (role in ('admin', 'operator')) default 'operator',
  is_active boolean default true,
  created_at timestamp default now()
);

create table if not exists products (
  id uuid primary key default gen_random_uuid (),
  company_id uuid references companies (id) on delete cascade,
  code text,
  barcode text,
  name text not null,
  cost_price numeric(10, 2) default 0,
  price numeric(10, 2) not null,
  stock int default 0,
  created_at timestamp default now()
);

create table if not exists cash_registers (
  id uuid primary key default gen_random_uuid (),
  company_id uuid references companies (id) on delete cascade,
  user_id uuid references users (id) on delete set null,
  opening_balance numeric(10, 2) default 0,
  is_open boolean default true,
  opened_at timestamp default now(),
  closed_at timestamp
);

create table if not exists sales (
  id uuid primary key default gen_random_uuid (),
  company_id uuid references companies (id) on delete cascade,
  sale_number int not null,
  receipt_serial text default '111-000001',
  total_amount numeric(10, 2) not null,
  payment_cash numeric(10, 2) default 0,
  payment_pix numeric(10, 2) default 0,
  payment_card numeric(10, 2) default 0,
  change_amount numeric(10, 2) default 0,
  customer_name text,
  customer_document text,
  operator_id uuid references users (id) on delete set null,
  created_at timestamp default now()
);
