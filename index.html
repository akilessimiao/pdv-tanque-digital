<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDV Tanque Digital - Login</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
    .container { background: rgba(255, 255, 255, 0.95); border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); width: 100%; max-width: 450px; padding: 40px; text-align: center; animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .logo-icon { width: 80px; height: 80px; background: linear-gradient(135deg, #1a73e8 0%, #0d62d9 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; color: white; font-size: 36px; box-shadow: 0 8px 20px rgba(26, 115, 232, 0.4); }
    h1 { font-size: 28px; color: #1a73e8; margin-bottom: 8px; font-weight: 700; }
    .logo-subtitle { color: #666; font-size: 15px; margin-top: 5px; }
    .login-tabs { display: flex; gap: 10px; margin-bottom: 30px; background: #f8f9fa; padding: 5px; border-radius: 12px; box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05); }
    .tab-btn { flex: 1; padding: 12px; border: none; background: transparent; border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: 600; color: #666; transition: all 0.3s ease; }
    .tab-btn:hover { background: rgba(26, 115, 232, 0.1); color: #1a73e8; }
    .tab-btn.active { background: linear-gradient(135deg, #1a73e8 0%, #0d62d9 100%); color: white; box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3); }
    .form-group { margin-bottom: 20px; text-align: left; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px; }
    .form-group input { width: 100%; padding: 14px 16px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 16px; transition: all 0.3s ease; }
    .form-group input:focus { outline: none; border-color: #1a73e8; box-shadow: 0 0 0 4px rgba(26, 115, 232, 0.1); }
    .btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .btn-login { background: linear-gradient(135deg, #1a73e8 0%, #0d62d9 100%); color: white; box-shadow: 0 4px 15px rgba(26, 115, 232, 0.4); }
    .btn-login:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(26, 115, 232, 0.5); }
    .btn-activate { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4); }
    .btn-activate:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(40, 167, 69, 0.5); }
    .activation-info { background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: left; font-size: 14px; color: #2e7d32; }
    .login-footer { margin-top: 35px; padding-top: 25px; border-top: 1px solid #eee; }
    .login-footer p { margin: 8px 0; color: #666; font-size: 14px; }
    .version { color: #999; font-size: 13px; margin-top: 5px; }
    .debug { position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: #fff; padding: 5px 10px; font-size: 12px; border-radius: 5px; z-index: 1000; display: none; }
    .success { background: #28a745; }
    .error { background: #dc3545; }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo-icon">
      <i class="fas fa-gas-pump"></i>
    </div>
    <h1>PDV Tanque Digital</h1>
    <p class="logo-subtitle">Sistema Completo de Gest√£o de Vendas</p>
    
    <div class="login-tabs">
      <button class="tab-btn active" id="loginTabBtn">Login</button>
      <button class="tab-btn" id="activateTabBtn">Ativar</button>
    </div>

    <div id="loginTab">
      <div class="form-group">
        <label>Usu√°rio</label>
        <input type="text" id="username" placeholder="admin" value="admin">
      </div>
      <div class="form-group">
        <label>Senha</label>
        <input type="password" id="password" placeholder="admin123" value="admin123">
      </div>
      <button class="btn btn-login" id="loginBtn">
        <i class="fas fa-sign-in-alt"></i> ENTRAR
      </button>
    </div>
    
    <div id="activateTab" style="display:none">
      <div class="activation-info">
        <p><i class="fas fa-info-circle"></i> Digite o c√≥digo de ativa√ß√£o: <strong>TQD-DEMO-2024</strong></p>
      </div>
      <div class="form-group">
        <label>C√≥digo de Ativa√ß√£o</label>
        <input type="text" id="serialKey" placeholder="TQD-DEMO-2024" value="TQD-DEMO-2024" maxlength="14">
      </div>
      <button class="btn btn-activate" id="activateBtn">
        <i class="fas fa-key"></i> ATIVAR LICEN√áA
      </button>
    </div>
    
    <div class="login-footer">
      <p><i class="fas fa-shield-alt"></i> Sistema seguro e protegido</p>
      <p class="version">Vers√£o 3.1 ‚Ä¢ Tanque Digital ¬© 2024</p>
      <p><strong style="color: #1a73e8;">üìç Suporte Local: Natal/RN - Resposta em minutos!</strong></p>
    </div>
  </div>

  <div class="debug" id="debugMsg"></div>

  <script>
    // üîë CONFIGURA√á√ÉO SUPABASE (J√Å COM SUAS CHAVES)
    const SUPABASE_URL = 'https://qxgwpcpgkemxnjfyncfu.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF4Z3dwY3Bna2VteG5qZnluY2Z1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NzUyMzcsImV4cCI6MjA4NjE1MTIzN30.7a5RzenN6rHGyoaxewxs05rGEH9cXj7sxRtfxGVl0SI';
    const supabase = window.supabase.create({ supabaseUrl: SUPABASE_URL, supabaseKey: SUPABASE_ANON_KEY });

    // Tabs
    document.getElementById('loginTabBtn').addEventListener('click', () => {
      document.getElementById('loginTab').style.display = 'block';
      document.getElementById('activateTab').style.display = 'none';
      document.getElementById('loginTabBtn').classList.add('active');
      document.getElementById('activateTabBtn').classList.remove('active');
    });
    
    document.getElementById('activateTabBtn').addEventListener('click', () => {
      document.getElementById('loginTab').style.display = 'none';
      document.getElementById('activateTab').style.display = 'block';
      document.getElementById('loginTabBtn').classList.remove('active');
      document.getElementById('activateTabBtn').classList.add('active');
    });

    // Login
    document.getElementById('loginBtn').addEventListener('click', async () => {
      showDebug('üîç Verificando login...', 'info');
      
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      
      if (!username || !password) {
        showDebug('‚ùå Preencha usu√°rio e senha!', 'error');
        return;
      }
      
      try {
        const { data, error } = await supabase
          .from('users')
          .select('id, company_id, username, role')
          .eq('username', username)
          .eq('password_hash', password)
          .single();
        
        if (error || !data) {
          showDebug('‚ùå Usu√°rio/senha inv√°lidos!', 'error');
          alert('Usu√°rio ou senha inv√°lidos!\nTente: admin / admin123');
          return;
        }
        
        localStorage.setItem('userId', data.id);
        localStorage.setItem('companyId', data.company_id);
        localStorage.setItem('username', data.username);
        localStorage.setItem('role', data.role);
        
        showDebug('‚úÖ Login bem-sucedido!', 'success');
        window.location.href = 'dashboard.html';
        
      } catch (err) {
        console.error('Erro no login:', err);
        showDebug('‚ùå Erro de conex√£o. Verifique o console (F12).', 'error');
        alert('Erro ao conectar. Abra o console (F12) e veja os erros.');
      }
    });

    // Ativa√ß√£o
    document.getElementById('activateBtn').addEventListener('click', async () => {
      showDebug('üîç Verificando ativa√ß√£o...', 'info');
      
      const serial = document.getElementById('serialKey').value.toUpperCase().replace(/[^A-Z0-9]/g, '');
      
      if (serial !== 'TQD-DEMO-2024') {
        showDebug('‚ùå C√≥digo inv√°lido! Use: TQD-DEMO-2024', 'error');
        alert('C√≥digo inv√°lido!\nUse exatamente: TQD-DEMO-2024');
        return;
      }
      
      try {
        // Verificar se j√° existe empresa
        const {  company } = await supabase
          .from('companies')
          .select('id')
          .eq('company_name', 'Minha Empresa')
          .single();
        
        if (company) {
          // Empresa j√° existe - s√≥ criar usu√°rio admin
          await supabase.from('users').insert({
            company_id: company.id,
            username: 'admin',
            password_hash: 'admin123',
            role: 'admin'
          });
          
          showDebug('‚úÖ Sistema j√° ativado! Login: admin / admin123', 'success');
          alert('‚úÖ Sistema j√° ativado!\nUsu√°rio: admin\nSenha: admin123');
          document.getElementById('loginTabBtn').click();
          return;
        }
        
        // Criar empresa nova
        const {  newCompany } = await supabase
          .from('companies')
          .insert({ company_name: 'Minha Empresa' })
          .select()
          .single();
        
        // Criar usu√°rio admin
        await supabase.from('users').insert({
          company_id: newCompany.id,
          username: 'admin',
          password_hash: 'admin123',
          role: 'admin'
        });
        
        showDebug('‚úÖ Ativa√ß√£o conclu√≠da! Login: admin / admin123', 'success');
        alert('‚úÖ Ativa√ß√£o conclu√≠da!\nUsu√°rio: admin\nSenha: admin123');
        document.getElementById('loginTabBtn').click();
        
      } catch (err) {
        console.error('Erro na ativa√ß√£o:', err);
        showDebug('‚ùå Erro na ativa√ß√£o. Verifique o console (F12).', 'error');
        alert('Erro na ativa√ß√£o. Abra o console (F12) e veja os erros.');
      }
    });

    // Debug helper
    function showDebug(message, type) {
      const debugEl = document.getElementById('debugMsg');
      debugEl.textContent = message;
      debugEl.style.display = 'block';
      debugEl.className = `debug ${type}`;
      
      if (type !== 'info') {
        setTimeout(() => {
          debugEl.style.display = 'none';
        }, 3000);
      }
      
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    // Tecla Enter no login
    document.getElementById('password').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') document.getElementById('loginBtn').click();
    });
    
    document.getElementById('serialKey').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') document.getElementById('activateBtn').click();
    });
  </script>
</body>
</html>